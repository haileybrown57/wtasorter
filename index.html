<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>WTA Top 100 Sorter</title>

  <style>
    body {
      margin: 0;
      font-family: "Times New Roman", serif;
      color: #000;
      background: #fff;
    }

    .wrap {
      max-width: 900px;
      margin: 30px auto;
      padding: 0 16px 40px;
    }

    .header {
      text-align: center;
      margin-bottom: 20px;
    }

    h1 {
      margin: 0 0 10px;
      font-size: 28px;
      letter-spacing: 0.5px;
    }

    .instructions {
      margin: 0;
      font-size: 18px;
      line-height: 1.45;
    }

    .status {
      text-align: center;
      margin: 24px 0 16px;
      font-size: 22px;
      font-weight: bold;
    }

    table {
      width: 100%;
      border-collapse: separate;
      border-spacing: 14px 10px;
    }

    td {
      border: 2px solid #000;
      text-align: center;
      vertical-align: middle;
      background: #fff;
    }

    /* FORCE TEXT TO BE VISIBLE (prevents Tumblr/theme CSS from hiding it) */
    .choice,
    .middle {
      color: #000 !important;
      background: #fff !important;
      position: relative;
      z-index: 1;
    }

    .choice {
      width: 42%;
      height: 180px;
      cursor: pointer;
      padding: 14px;
      user-select: none;
      font-size: 28px;
    }

    .middle {
      width: 16%;
      height: 80px;
      cursor: pointer;
      padding: 10px;
      user-select: none;
      font-size: 18px;
    }

    .controls {
      display: flex;
      justify-content: center;
      gap: 14px;
      margin-top: 20px;
      flex-wrap: wrap;
    }

    button {
      font: inherit;
      font-size: 18px;
      border: 2px solid #000;
      background: #fff;
      padding: 10px 16px;
      cursor: pointer;
    }

    button:hover {
      background: #f0f0f0;
    }

    .results {
      margin-top: 30px;
      text-align: center;
    }

    .results table {
      width: 520px;
      margin: 0 auto;
      border-collapse: collapse;
      font-size: 18px;
    }

    .results th,
    .results td {
      border: 2px solid #000;
      padding: 8px 10px;
    }

    .results th {
      background: #e097d9;
      color: #fff;
    }

    .footer {
      text-align: center;
      margin-top: 30px;
      font-size: 14px;
      opacity: 0.85;
    }

    @media (max-width: 600px) {
      .choice { height: 140px; font-size: 20px; }
      .middle { font-size: 16px; }
      .results table { width: 100%; }
    }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="header">
      <h1>WTA TOP 100 SORTER</h1>
      <p class="instructions">
        Pick the player you prefer in each matchup to generate your personal ranking.<br>
        Note: frequent ties or “no opinion” will reduce ranking precision.
      </p>
    </div>

    <div id="battleNumber" class="status">battle #1<br>0% sorted.</div>

    <table role="presentation">
      <tr>
        <td id="leftField" class="choice" rowspan="2"></td>
        <td id="bothBtn" class="middle">I like both</td>
        <td id="rightField" class="choice" rowspan="2"></td>
      </tr>
      <tr>
        <td id="noOpinionBtn" class="middle">no opinion</td>
      </tr>
    </table>

    <div class="controls">
      <button id="resetBtn" type="button">Reset</button>
      <button id="shuffleBtn" type="button">Shuffle &amp; Reset</button>
    </div>

    <div id="resultField" class="results"></div>

    <div class="footer">
      Top 100 WTA singles sorter (hosted on GitHub Pages, embedded in Tumblr).
    </div>
  </div>

  <script>
    // TOP 100 WTA PLAYERS (as provided)
    var namMember = [
      "Aryna Sabalenka","Iga Swiatek","Coco Gauff","Amanda Anisimova","Elena Rybakina",
      "Jessica Pegula","Madison Keys","Jasmine Paolini","Mirra Andreeva","Ekaterina Alexandrova",
      "Belinda Bencic","Clara Tauson","Linda Noskova","Elina Svitolina","Emma Navarro",
      "Naomi Osaka","Liudmila Samsonova","Victoria Mboko","Karolina Muchova","Elise Mertens",
      "Diana Shnaider","Leylah Fernandez","Jelena Ostapenko","Qinwen Zheng","Paula Badosa",
      "Marta Kostyuk","Dayana Yastremska","Sofia Kenin","Emma Raducanu","Veronika Kudermetova",
      "McCartney Kessler","Maya Joint","Anna Kalinskaya","Marketa Vondrousova","Iva Jovic",
      "Lois Boisson","Daria Kasatkina","Ann Li","Jaqueline Cristian","Eva Lys",
      "Jessica Bouzas Maneiro","Marie Bouzkova","Sorana Cirstea","Ashlyn Krueger","Tatjana Maria",
      "Laura Siegemund","Anastasia Pavlyuchenkova","Katerina Siniakova","Emiliana Arango",
      "Anastasia Potapova","Cristina Bucsa","Maria Sakkari","Alexandra Eala","Magda Linette",
      "Elsa Jacquemot","Janice Tjen","Xinyu Wang","Beatriz Haddad Maia","Magdalena Frech",
      "Tereza Valentova","Hailey Baptiste","Anna Blinkova","Peyton Stearns","Danielle Collins",
      "Barbora Krejcikova","Solana Sierra","Olga Danilovic","Sonay Kartal","Donna Vekic",
      "Antonia Ruzic","Yulia Putintseva","Rebecca Sramkova","Francesca Jones","Anna Bondar",
      "Ons Jabeur","Varvara Gracheva","Camila Osorio","Alycia Parks","Renata Zarazua",
      "Ajla Tomljanovic","Shuai Zhang","Viktorija Golubic","Elisabetta Cocciaretto","Petra Marcinko",
      "Caty McNally","Ella Seidel","Simona Waltert","Elena-Gabriela Ruse","Suzan Lamens",
      "Lulu Sun","Panna Udvardy","Sara Bejlek","Katie Volynets","Moyuka Uchijima",
      "Julia Grabher","Oleksandra Oliynykova","Kamilla Rakhimova","Kimberly Birrell",
      "Dalma Galfi","Oksana Selekhmeteva"
    ];

    // --- robust sorter engine (original merge-sort style) ---
    var lstMember = [];
    var parent = [];
    var equal = [];
    var rec = [];

    var cmp1, cmp2;
    var head1, head2;
    var nrec;

    var numQuestion;
    var totalSize;
    var finishSize;
    var finishFlag;

    function shuffleArray(arr) {
      for (let i = arr.length - 1; i > 0; i--) {
        const j = Math.floor(Math.random() * (i + 1));
        [arr[i], arr[j]] = [arr[j], arr[i]];
      }
    }

    function initList() {
      lstMember = [];
      parent = [];
      equal = [];
      rec = [];

      var n = 0;

      lstMember[n] = [];
      for (var i = 0; i < namMember.length; i++) lstMember[n][i] = i;
      parent[n] = -1;
      totalSize = 0;
      n++;

      for (var i2 = 0; i2 < lstMember.length; i2++) {
        if (lstMember[i2].length >= 2) {
          var mid = Math.ceil(lstMember[i2].length / 2);

          lstMember[n] = lstMember[i2].slice(0, mid);
          totalSize += lstMember[n].length;
          parent[n] = i2;
          n++;

          lstMember[n] = lstMember[i2].slice(mid);
          totalSize += lstMember[n].length;
          parent[n] = i2;
          n++;
        }
      }

      for (var j = 0; j < namMember.length; j++) rec[j] = 0;
      nrec = 0;

      for (var k = 0; k <= namMember.length; k++) equal[k] = -1;

      cmp1 = lstMember.length - 2;
      cmp2 = lstMember.length - 1;
      head1 = 0;
      head2 = 0;

      numQuestion = 1;
      finishSize = 0;
      finishFlag = 0;

      showImage();
    }

    function sortList(flag) {
      if (finishFlag) return;

      if (flag < 0) {
        rec[nrec++] = lstMember[cmp1][head1++];
        finishSize++;
        while (equal[rec[nrec - 1]] !== -1) {
          rec[nrec++] = lstMember[cmp1][head1++];
          finishSize++;
        }
      } else if (flag > 0) {
        rec[nrec++] = lstMember[cmp2][head2++];
        finishSize++;
        while (equal[rec[nrec - 1]] !== -1) {
          rec[nrec++] = lstMember[cmp2][head2++];
          finishSize++;
        }
      } else {
        rec[nrec++] = lstMember[cmp1][head1++];
        finishSize++;
        while (equal[rec[nrec - 1]] !== -1) {
          rec[nrec++] = lstMember[cmp1][head1++];
          finishSize++;
        }

        equal[rec[nrec - 1]] = lstMember[cmp2][head2];

        rec[nrec++] = lstMember[cmp2][head2++];
        finishSize++;
        while (equal[rec[nrec - 1]] !== -1) {
          rec[nrec++] = lstMember[cmp2][head2++];
          finishSize++;
        }
      }

      if (head1 < lstMember[cmp1].length && head2 === lstMember[cmp2].length) {
        while (head1 < lstMember[cmp1].length) {
          rec[nrec++] = lstMember[cmp1][head1++];
          finishSize++;
        }
      } else if (head1 === lstMember[cmp1].length && head2 < lstMember[cmp2].length) {
        while (head2 < lstMember[cmp2].length) {
          rec[nrec++] = lstMember[cmp2][head2++];
          finishSize++;
        }
      }

      if (head1 === lstMember[cmp1].length && head2 === lstMember[cmp2].length) {
        for (var m = 0; m < lstMember[cmp1].length + lstMember[cmp2].length; m++) {
          lstMember[parent[cmp1]][m] = rec[m];
        }

        lstMember.pop();
        lstMember.pop();

        cmp1 -= 2;
        cmp2 -= 2;
        head1 = 0;
        head2 = 0;

        for (var r = 0; r < namMember.length; r++) rec[r] = 0;
        nrec = 0;
      }

      if (cmp1 < 0) {
        document.getElementById("battleNumber").innerHTML =
          "complete<br>100% sorted.";
        showResult();
        finishFlag = 1;
      } else {
        showImage();
      }
    }

    function escapeHtml(str) {
      return String(str)
        .replaceAll("&", "&amp;")
        .replaceAll("<", "&lt;")
        .replaceAll(">", "&gt;")
        .replaceAll('"', "&quot;")
        .replaceAll("'", "&#039;");
    }

    function showResult() {
      var ranking = 1;
      var sameRank = 1;
      var html = "";

      html += "<table><tr><th>rank</th><th>player</th></tr>";

      for (var i = 0; i < namMember.length; i++) {
        html += "<tr><td>" + ranking + "</td><td>" + escapeHtml(namMember[lstMember[0][i]]) + "</td></tr>";

        if (i < namMember.length - 1) {
          if (equal[lstMember[0][i]] === lstMember[0][i + 1]) {
            sameRank++;
          } else {
            ranking += sameRank;
            sameRank = 1;
          }
        }
      }

      html += "</table>";
      document.getElementById("resultField").innerHTML = html;
    }

    function showImage() {
      document.getElementById("battleNumber").innerHTML =
        "battle #" + numQuestion + "<br>" + Math.floor((finishSize * 100) / totalSize) + "% sorted.";

      document.getElementById("leftField").textContent =
        namMember[lstMember[cmp1][head1]];

      document.getElementById("rightField").textContent =
        namMember[lstMember[cmp2][head2]];

      numQuestion++;
    }

    // wire up buttons
    document.getElementById("leftField").addEventListener("click", function () { sortList(-1); });
    document.getElementById("rightField").addEventListener("click", function () { sortList(1); });
    document.getElementById("bothBtn").addEventListener("click", function () { sortList(0); });
    document.getElementById("noOpinionBtn").addEventListener("click", function () { sortList(0); });

    document.getElementById("resetBtn").addEventListener("click", function () {
      initList();
    });

    document.getElementById("shuffleBtn").addEventListener("click", function () {
      shuffleArray(namMember);
      initList();
    });

    // start
    initList();
  </script>
</body>
</html>
